# Chap 8. 경계 간 매핑하기

### '매핑하지 않기' 전략

매핑하지 않기는 웹 계층과 영속성 계층 애플리케이션 계층 모두 같은 모델을 사용하니 매핑을 전혀 할 필요가 없다. 그러나 웹 계층 또는 영속성 계층에 특별한 요구사항이 있을 수 있다. 그럴 경우 도메인과 애플리케이션 계층은 특별한 요구사항에 관심이 없음에도 불구하고 다뤄야한다. 이러한 이유로 **단일 책임 원칙**을 위배하게 된다.

하지만 간단한 CRUD에 대한 유스케이스라면 매핑하지 않기 전략이 더 좋을 수 있다.



### '양방향' 매핑 전략

#### 장점

각 계층이 전용 모델을 가지고 있기 때문에 다른 계층에 영향이 없다. 그리고 영속성 모델은 데이터베이스에 객체를 저장하기 위해 ORM에서 필요로 하는 구조를 가질 수 있다.

또한 간단하고 책임이 명확하여 도메인 로직에 집중할 수 있다.

#### 단점

너무 많은 보일러 플레이트 코드가 생긴다.

도메인 모델이 계층 경계를 넘어서 통신하는데 사용되고 있다. 도메인 모델은 도메인 모델의 필요에 의해서 변경되야 이상적이지만 바깥쪽 계층의 요구에 따라 변경에 취약해진다.



이 또한 실버불렛은 아니기 때문에 유스케이스마다 적절한 전략을 택해야 한다.



### '완전' 매핑 전략

이 매핑은 각 연산마다 별도의 입출력 모델을 사용한다.

웹 계층은 입력을 애플리케이션 계층의 커맨드 객체로 매핑할 책임을 가진다. 각 유스케이스는 전용 필드와 유효성 검증 로직을 가진 전용 커맨드를 가진다. 그 이후 유스케이스에 따라 도메인 모델을 변경하기 위해 필요한 무엇인가로 매핑할 책임을 가진다. 이 방식은 한 계층을 다른 여러 개의 커맨드로 매핑하는 데는 하나의 웹 모델과 도메인 모델 간의 매핑보다 더 많은 코드가 필요하지만 여러 유스케이스의 요구사항을 함께 다뤄야 하는 매핑에 비해 구현하고 유지보수하기가 훨씬 쉽다.

이 전략은 전역 패턴으로 추천되지 않지만, 웹 계층과 애플리케이션 계층 사이에서 상태 변경 유스케이스의 경계를 명확하게 할 때 가장 빛을 발한다.



### '단방향' 매핑 전략

이 전략은 모든 계층의 모델들이 같은 인터페이스를 구현하여 관련있는 특성에 대한 getter메소드를 제공해 도메인 모델의 상태를 캡슐화한다.

도메인 객체를 바깥 계층으로 전달하고 싶으면 매핑없이 할 수 있다. 왜냐하면 도메인 객체가 인커밍/아웃고잉 포트가 기대하는 대로 상태 인터페이스를 구현하고 있기 때문이다.

이 매핑은 팩토리라는 DDD 개념과 잘 어울리는데 팩토리는 어떤 특정한 상태로부터 도메인 객체를 재구성할 책임을 가지고 있다.

이 전략에서 매핑 책임은 한 계층이 다른 계층으로부터 객체를 받으면 해당 계층에서 이용할 수 있도록 매핑하는 것이다. 이 전략은 계층 간의 모델이 비슷할 때 가장 효과적이다.



### 언제 어떤 매핑 전략을 사용할 것인가?

이 질문의 답은 **그때그때 다르다**이다. 각 매핑 전략이 장단점을 갖고 있기 때문에 한 전략을 전체 코드에 대한 전역 규칙으로 정의하려는 충동을 이겨내야 한다. 또 소프트웨어는 시간이 지나며 변화를 거듭하기 때문에, 어제는 최선이었던 전략이 오늘은 최선이 아닐 수 있다.

언제 어떤 전략을 사용할지 결정하려면 팀 내에서 합의할 수 있는 가이드라인을 정해둬야 한다. 가이드라인은 어떤 상황에서 어떤 매핑 전략을 가장 먼저 택해야 하는가에 답할 수 있어야 한다. 또한 왜 해당 전략을 최우선으로 택해야 하는지도 설명할 수 있어야 한다.



### 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

상황별로 매핑 전략을 선택하는게 어렵고 많은 커뮤니케이션이 필요하겠지만 매핑 가이드라인이 있으면 코드는 정확히 해야 하는 일만 수행하고, 유지보수하기 좋은 코드가 된다.