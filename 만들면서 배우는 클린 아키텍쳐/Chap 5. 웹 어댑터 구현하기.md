# Chap 5. 웹 어댑터 구현하기

### 의존성 역전

웹 어댑터는 `주도하는` 혹은 `인커밍`어댑터이다. 외부로부터 요청을 받아 어플리케이션 코어를 호출하고 무엇을 할지 알려준다. 이 때 제어 흐름은 웹 어댑터에 있는 컨트롤러에서 어플리케이션 계층에 있는 서비스로 흐른다.

여기에서 **의존성 역전 원칙**이 적용된다. 제어 흐름을 확인해보면 웹 어댑터에서 유스케이스를 직접 호출할 수 있는 것을 볼 수 있다. 여기서 어댑터와 유스케이스 사이에 `간접 계층`을 넣어야 하는데 이는 어플리케이션 코어가 외부와 통신할 수 있는 곳에 대한 명세가 `포트`이기 때문이다. 포트를 적절히 위치시키면 외부와 어떠한 통신이 일어나는지 알 수 있고 유지보수하는데 도움이 된다.

어플리케이션 코어에서 실시간 데이터를 웹 어댑터로 보내고, 웹 어댑터는 이 데이터를 사용자에게 보내기 위해서 반드시 포트가 필요하다. 이 포트는 웹 어댑터에서 구현하고, 어플리케이션 코어에서 호출해야 한다. 여기서 이 포트는 아웃고잉 포트이기 때문에 웹 어댑터는 `인커밍 어댑터` 인 동시에 `아웃고잉 어댑터`가 된다.



### 웹 어댑터의 책임

##### 웹 어댑터가 일반적으로 하는 일

1. HTTP 요청을 자바 객체로 매핑
2. 권한 검사
3. 입력 유효성 검증
4. 입력을 유스케이스의 입력 모델로 매핑
5. 유스케이스 호출
6. 유스케이스의 출력을 HTTP로 매핑
7. HTTP 응답을 반환

웹 어댑터는 URL, 경로, HTTP 메소드, 콘텐츠 타입과 같이 특정 기준을 만족하는 HTTP 요청을 수신하고, HTTP 요청의 파라미터와 콘텐츠를 객체로 역직렬화해야 한다.

웹 어댑터의 경우 유스케이스 입력 모델에서 했던 것과 같이 검증을 하지 않고 **웹 어댑터의 입력 모델을 유스케이스의 입력 모델로 변환할 수 있다**라는 것을 검증해야 한다.

웹 어댑터의 책임은 많으면서도 어플리케이션 계층이 신경 쓰면 안되는 것들이긴 하다. HTTP와 관련된 것은 어플리케이션 계층을 침투해서는 안된다. 만약 바깥계층에서 HTTP를 다루고 있다는 것을 코어가 알게되면 또 다른 인커밍 어댑터의 요청이 동일한 도메인 로직을 수행할 수 있는 선택지를 잃게 되기 때문에 좋은 아키텍처는 선택의 여지를 남겨둔다.



### 컨트롤러 나누기

웹 어댑터는 한 개 이상의 클래스로 구성하면 된다. 하지만 클래스들이 같은 소속이라는 것을 표현하기 위해 같은 패키지 수준에 두어야 한다.

**컨트롤러는 가능한 좁고, 다른 컨트롤러와 가능한 적게 공유하는 웹 어댑터 조각을 구현해야 한다.**

하나의 리소스와 관련된 모든 것이 하나의 클래스에 모여있으면 괜찮아 보이지만 이 방식은 단점이 있다. 클래스마다 코드가 많은 경우에는 하나의 컨트롤러를 파악하는데 시간이 많이 걸리고, 또한 테스트코드가 많이 존재하게 된다. 보통 테스트 코드는 추상적이기 때문에 파악이 더 어렵다. 또한 모든 연산을 단일 컨트롤러에 넣는 것이 **데이터 구조의 재활용을 촉진**한다.

각각의 전용 모델 클래스들은 컨트롤러 패키지에 대해 private으로 선언 가능하기 때문에 실수로 다른 곳에서 재사용될 일이 없다. 또한 컨트롤러와 서비스명에 충분히 의미를 드러낼 수 있도록 네이밍 하는 것이 좋다.



### 유지보수 가능한 소프트웨어를 만드는데 어떻게 도움이 될까?

웹 컨트롤러를 나눌 때는 모델을 공유하지 않는 작은 클래스로 만들면 작업 공수는 조금 더 들겠지만, 파악이 쉽고, 테스트가 쉬우며 동시 작업을 지원한다는 장점이 있다.



## Q&A

나누기를 하면 이름짓기가 필요한데 이름 짓기가 어렵다

* 이름을 지으면서 고민하면서 해당 기능에 대한 정확한 파악을 할 수 있다.



#### 입력 유효성 검증을 별도로 해야 한다고 했는데, 웹 어댑터 폼 같은게 맞는지

폼에 대한 유효성 검증이 `@valid`로 검증하는 것이고, 웹 어댑터에서도 검증 로직이 있고, 내부에서도 로직이 따로 존재.

>https://www.baeldung.com/spring-boot-bean-validation

웹 어댑터에서 들어오면 형태적인 validation 체크를 하고, 중복이과 같은 내용은 유스케이스 validation에서 하는 게 좋다.

* 어댑터와 유스케이스의 역할에 따라서 검증 대상이 달라진다.



